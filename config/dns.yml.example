
# Application DNS Configuration

# This file defines applications and their DNS records.
# Terraform reads this file to generate DNS records dynamically.
#
# COPY THIS FILE: cp dns.yml.example dns.yml
# Then customize for your deployment.
#
# NOTE: Domains are defined in project.yml. This file only defines which
#       subdomains exist and which server they point to.


# -----------------------------------------------------------------------------
# Server Definitions
# -----------------------------------------------------------------------------
# Define which Terraform module/IP each server name refers to.
# These are referenced in the apps section below.

servers:
  # Identity/SSO server
  authentik:
    description: "Authentik identity provider"
    # In Terraform, this resolves to: module.authentik_prod.ip_address
    module: "authentik_prod"
  
  # Main tools/applications server
  tools:
    description: "Production tools and applications"
    # In Terraform, this resolves to: module.tools_prod.ip_address
    module: "tools_prod"
  
  # Management/monitoring server
  management:
    description: "Monitoring, logging, and management tools"
    # In Terraform, this resolves to: module.management_prod.ip_address
    module: "management_prod"
  
  # Staging server
  staging:
    description: "Staging environment for testing"
    # In Terraform, this resolves to: module.staging.ip_address
    module: "staging"

# -----------------------------------------------------------------------------
# DNS Records Configuration
# -----------------------------------------------------------------------------
# Define DNS records per domain zone.
# Each record needs: subdomain, type, and either server (for A records) or target (for CNAME)

dns_records:
  # Records for the tools domain (from project.yml: domains.tools)
  tools:
    # --- Authentik SSO Infrastructure ---
    - subdomain: "authentik"
      type: "A"
      server: "authentik"
      description: "Authentik admin interface"
    
    - subdomain: "gateway"
      type: "A"
      server: "authentik"
      description: "Authentik SSO gateway (forward auth endpoint)"
    
    # --- Production Applications ---
    - subdomain: "cloud"
      type: "A"
      server: "tools"
      description: "Nextcloud file sharing"
    
    - subdomain: "wiki"
      type: "A"
      server: "tools"
      description: "Outline knowledge base"
    
    - subdomain: "erp"
      type: "A"
      server: "tools"
      description: "EspoCRM"
    
    - subdomain: "voting"
      type: "A"
      server: "tools"
      description: "Decidim participatory democracy"
    
    - subdomain: "decidim"
      type: "A"
      server: "tools"
      description: "Decidim (alternate subdomain)"
    
    - subdomain: "cryptpad"
      type: "A"
      server: "tools"
      description: "CryptPad encrypted collaboration"
    
    - subdomain: "n8n"
      type: "A"
      server: "tools"
      description: "N8N workflow automation"
    
    # --- Test/Development ---
    - subdomain: "test-decidim"
      type: "A"
      server: "tools"
      description: "Decidim test instance"
    
    # --- External Services (CNAME) ---
    - subdomain: "www"
      type: "CNAME"
      target: "ext-sq.squarespace.com."
      description: "Marketing website on Squarespace"
    
  # Records for the management domain (from project.yml: domains.management)
  management:
    - subdomain: "grafana"
      type: "A"
      server: "management"
      description: "Grafana dashboards"
    
    - subdomain: "loki"
      type: "A"
      server: "management"
      description: "Loki log aggregation"
    
    - subdomain: "prometheus"
      type: "A"
      server: "management"
      description: "Prometheus metrics"
    
    - subdomain: "wazuh"
      type: "A"
      server: "management"
      description: "Wazuh SIEM"
    
    - subdomain: "portainer"
      type: "A"
      server: "management"
      description: "Portainer container management"
    
    # Wildcard for management domain
    - subdomain: "*"
      type: "A"
      server: "management"
      description: "Catch-all for management subdomains"

  # Records for the staging domain (from project.yml: domains.staging)
  staging:
    - subdomain: "outline"
      type: "A"
      server: "staging"
      description: "Outline staging instance"
    
    - subdomain: "espocrm"
      type: "A"
      server: "staging"
      description: "EspoCRM staging instance"
    
    - subdomain: "decidim"
      type: "A"
      server: "staging"
      description: "Decidim staging instance"
    
