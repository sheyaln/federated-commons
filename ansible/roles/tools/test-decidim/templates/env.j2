RAILS_ENV=production
RAILS_LOG_TO_STDOUT=true
RAILS_SERVE_STATIC_FILES=true

# Note: $ characters are escaped as $$ for docker-compose compatibility
DATABASE_URL=postgres://{{ DECIDIM_DB_USER }}:{{ DECIDIM_DB_PASSWORD | replace('$', '$$') }}@{{ DECIDIM_DB_HOST }}:{{ DECIDIM_DB_PORT }}/{{ DECIDIM_DB_NAME }}
POSTGRES_HOST={{ DECIDIM_DB_HOST }}
POSTGRES_USER={{ DECIDIM_DB_USER }}
POSTGRES_PASSWORD={{ DECIDIM_DB_PASSWORD | replace('$', '$$') }}
POSTGRES_DB={{ DECIDIM_DB_NAME }}
POSTGRES_PORT={{ DECIDIM_DB_PORT }}

SECRET_KEY_BASE={{ DECIDIM_SECRET_KEY_BASE }}
FORCE_SSL=yes
PORT=3000

REDIS_URL=redis://test-decidim-redis:6379/1
MEMCACHED_HOST=test-decidim-memcached

SMTP_ADDRESS={{ DECIDIM_SMTP_ADDRESS }}
SMTP_DOMAIN={{ DECIDIM_SMTP_DOMAIN }}
SMTP_USERNAME={{ DECIDIM_SMTP_USERNAME }}
SMTP_PASSWORD={{ DECIDIM_SMTP_PASSWORD }}
SMTP_PORT={{ DECIDIM_SMTP_PORT }}
SMTP_AUTHENTICATION={{ DECIDIM_SMTP_AUTHENTICATION }}
SMTP_FROM_EMAIL={{ DECIDIM_SMTP_FROM_EMAIL }}

DECIDIM_HOST={{ DECIDIM_HOST }}
DECIDIM_DEFAULT_FROM_EMAIL={{ DECIDIM_SMTP_FROM_EMAIL }}

# System admin credentials (for /system panel)
DECIDIM_SYSTEM_EMAIL={{ DECIDIM_DEFAULT_ADMIN_EMAIL }}
DECIDIM_SYSTEM_PASSWORD={{ DECIDIM_DEFAULT_ADMIN_PASSWORD | replace('$', '$$') }}

# Organization configuration (auto-created on first deploy)
DECIDIM_ORG_NAME={{ org_name }}
DECIDIM_ORG_HOST={{ DECIDIM_HOST }}
DECIDIM_DEFAULT_LOCALE={{ locale.split('_')[0] }}
DECIDIM_AVAILABLE_LOCALES={{ locale.split('_')[0] }}
DECIDIM_REFERENCE_PREFIX={{ org_slug | upper }}

# Organization admin (first admin user for the org)
DECIDIM_ORG_ADMIN_EMAIL={{ admin_email }}
DECIDIM_ORG_ADMIN_PASSWORD={{ DECIDIM_DEFAULT_ADMIN_PASSWORD | replace('$', '$$') }}
DECIDIM_ORG_ADMIN_NAME={{ org_name }} Admin
DECIDIM_ORG_ADMIN_NICKNAME=admin

# OAuth2 Generic Provider Configuration
{% if DECIDIM_OAUTH2_ENABLED | default(false) %}
OAUTH2_CLIENT_ID={{ DECIDIM_OAUTH2_CLIENT_ID | default('') }}
OAUTH2_CLIENT_SECRET={{ DECIDIM_OAUTH2_CLIENT_SECRET | default('') }}
OAUTH2_SITE={{ DECIDIM_OAUTH2_SITE | default('') }}
OAUTH2_AUTHORIZE_URL={{ DECIDIM_OAUTH2_AUTHORIZE_URL | default('/application/o/authorize/') }}
OAUTH2_TOKEN_URL={{ DECIDIM_OAUTH2_TOKEN_URL | default('/application/o/token/') }}
OAUTH2_USER_INFO_URL={{ DECIDIM_OAUTH2_USER_INFO_URL | default('/application/o/userinfo/') }}
OAUTH2_ISSUER={{ DECIDIM_OAUTH2_ISSUER | default('') }}
{% endif %}

# LDAP Configuration
{% if DECIDIM_LDAP_ENABLED | default(false) %}
LDAP_HOST={{ DECIDIM_LDAP_HOST | default('') }}
LDAP_PORT={{ DECIDIM_LDAP_PORT | default('389') }}
LDAP_METHOD={{ DECIDIM_LDAP_METHOD | default('plain') }}
LDAP_BIND_DN={{ DECIDIM_LDAP_BIND_DN | default('') }}
LDAP_PASSWORD={{ DECIDIM_LDAP_PASSWORD | default('') }}
LDAP_BASE={{ DECIDIM_LDAP_BASE | default('') }}
LDAP_FILTER={{ DECIDIM_LDAP_FILTER | default('') }}
LDAP_UID={{ DECIDIM_LDAP_UID | default('uid') }}
LDAP_ATTR_EMAIL={{ DECIDIM_LDAP_ATTR_EMAIL | default('mail') }}
LDAP_ATTR_NAME={{ DECIDIM_LDAP_ATTR_NAME | default('cn') }}
LDAP_ATTR_NICKNAME={{ DECIDIM_LDAP_ATTR_NICKNAME | default('uid') }}
{% endif %}

# Decidim Awesome Configuration
DECIDIM_AWESOME_IMAGES_IN_EDITOR={{ DECIDIM_AWESOME_IMAGES_IN_EDITOR | default('true') }}
DECIDIM_AWESOME_IMAGES_IN_SMALL_EDITOR={{ DECIDIM_AWESOME_IMAGES_IN_SMALL_EDITOR | default('false') }}
DECIDIM_AWESOME_MARKDOWN_EDITOR={{ DECIDIM_AWESOME_MARKDOWN_EDITOR | default('true') }}
DECIDIM_AWESOME_AUTO_SAVE={{ DECIDIM_AWESOME_AUTO_SAVE | default('true') }}
DECIDIM_AWESOME_SCOPED_STYLES={{ DECIDIM_AWESOME_SCOPED_STYLES | default('true') }}
DECIDIM_AWESOME_ADMIN_ACCOUNTABILITY={{ DECIDIM_AWESOME_ADMIN_ACCOUNTABILITY | default('true') }}
DECIDIM_AWESOME_MENU_HACKS={{ DECIDIM_AWESOME_MENU_HACKS | default('true') }}
DECIDIM_AWESOME_PROPOSAL_CUSTOM_FIELDS={{ DECIDIM_AWESOME_PROPOSAL_CUSTOM_FIELDS | default('true') }}

