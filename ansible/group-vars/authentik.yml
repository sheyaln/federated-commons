---

# Authentik Group Variables

# These variables are used when deploying to the authentik-prod group.
# Domain/email settings are inherited from all.yml (which reads config/project.yml)


# -----------------------------------------------------------------------------
# Managed PostgreSQL Credentials (from Scaleway Secret Manager)
# -----------------------------------------------------------------------------
authentik_db_creds: "{{ lookup('scaleway.scaleway.scaleway_secret', 'postgres-authentik-credentials') | b64decode | from_json }}"

POSTGRES_DB: "{{ authentik_db_creds.dbname }}"
POSTGRES_USER: "{{ authentik_db_creds.username }}"
POSTGRES_PASSWORD: "{{ authentik_db_creds.password }}"
POSTGRES_HOST: "{{ authentik_db_creds.host }}"
POSTGRES_PORT: "{{ authentik_db_creds.port }}"

# -----------------------------------------------------------------------------
# Authentik Application Configuration
# -----------------------------------------------------------------------------
AUTHENTIK_SECRET_KEY: "{{ lookup('scaleway.scaleway.scaleway_secret', 'authentik-secret-key') | b64decode }}"
AUTHENTIK_IMAGE: ghcr.io/goauthentik/server
AUTHENTIK_TAG: 2025.12.1

# -----------------------------------------------------------------------------
# Authentik Admin Configuration
# -----------------------------------------------------------------------------
AUTHENTIK_ADMIN_USER: admin
AUTHENTIK_ADMIN_PASSWORD: "{{ lookup('scaleway.scaleway.scaleway_secret', 'authentik-admin-password') | b64decode }}"
AUTHENTIK_ADMIN_EMAIL: "{{ infra_email }}"

# -----------------------------------------------------------------------------
# Authentik Domain Configuration (inherited from all.yml)
# -----------------------------------------------------------------------------
AUTHENTIK_DOMAIN: "{{ gateway_domain }}"
AUTHENTIK_LEGACY_DOMAIN: "authentik.{{ tools_domain }}"
AUTHENTIK_URL: "https://{{ gateway_domain }}"

# -----------------------------------------------------------------------------
# Authentik Proxy Configuration
# -----------------------------------------------------------------------------
AUTHENTIK_PROXY_TOKEN: "{{ lookup('scaleway.scaleway.scaleway_secret', 'authentik-proxy-token') | b64decode }}"

# -----------------------------------------------------------------------------
# SMTP Configuration (inherited from all.yml)
# -----------------------------------------------------------------------------
AUTHENTIK_SMTP_HOST: "{{ smtp_host }}"
AUTHENTIK_SMTP_PORT: "{{ smtp_port }}"
AUTHENTIK_SMTP_USERNAME: "{{ smtp_username }}"
AUTHENTIK_SMTP_PASSWORD: "{{ smtp_password }}"
AUTHENTIK_SMTP_FROM: "{{ org_name }} Authentik <{{ infra_email }}>"
AUTHENTIK_SMTP_USE_TLS: false
AUTHENTIK_SMTP_USE_SSL: true

# -----------------------------------------------------------------------------
# Traefik Configuration (inherited from all.yml)
# -----------------------------------------------------------------------------
TRAEFIK_EMAIL: "{{ traefik_email }}"
